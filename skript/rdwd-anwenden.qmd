---
title: Das Paket rdwd verwenden
---

```{r}
#| echo: false
library(rdwd)
library(tidyverse)
library(lubridate)
library(data.table)
library(kableExtra)
```


## Regendaten einer Station

```{r, message=FALSE}
d <- selectDWD(name = "Bochum", res = "daily", var = "kl", per = "historical", current=TRUE) |>
  dataDWD(read = FALSE) |>
  readDWD(varnames = TRUE) |>
  mutate(datum = ymd(MESS_DATUM))
ggplot(data = d) + geom_col(mapping = aes(x = datum, y = RSK.Niederschlagshoehe))
```


## Parameter von `selectDWD`

- `name` : Name der Station
- `id` : Stationsnummer (statt Name)
- `res` : Resolution ("daily", "hourly")
- `var` : Variable ("kl", "more_precip")
  - "kl" : Verschiedene Klimadaten (mit Niederschlag)
  - "more_precip" : Weitere Niederschlagsdaten
- `per` : Period ("recent", "historical")
  - "recent" : Die letzten 500 Tage
  - "historical" : Alle vorliegenden Daten


## Lage der Stationen

```{r}
data("geoIndex")
geoIndex |> kable() |> scroll_box(height = "400px")
```


## Daten 체ber die Stationen

```{r}
data("metaIndex")
metaIndex |> slice_head(n = 8) |> kable() 
```


## Stationen raussuchen

```{r}
ids <- findID("Berlin", exactmatch = FALSE, quiet = TRUE)
metaIndex |>
  filter(Stations_id %in% ids, res == 'daily', var == 'kl', per == 'historical') |>
  select(Stationsname, von_datum, bis_datum) |> 
  kable() |> 
  scroll_box(height = "300px")
```

[]{.down40}

- Wir stellen fest, dass zwar alle Berliner Stationen ausgew채hlt wurden, aber auch zwei Stationen in S체ddeutschland, deren Namen die Buchstabenfolge "berlin" enthalten (die letzten beiden)
- Um diesem Fehler vorzubeugen erg채nzen wir einen Filter, der sicherstellt, dass der Name der Station mit "Berlin-" beginnt (filter(grpl()))

## Korrigierte Stationen raussuchen

```{r}
ids <- findID("Berlin", exactmatch = FALSE, quiet = TRUE)
metaIndex |>
  filter(Stations_id %in% ids, res == 'daily', var == 'kl', per == 'historical') |>
  select(Stationsname, von_datum, bis_datum) |> 
  filter(grepl("^Berlin-", Stationsname))  |>
  kable() |> 
  scroll_box(height = "400px")
```
